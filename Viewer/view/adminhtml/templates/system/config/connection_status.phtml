<?php
/**
 * Connection Status Template
 *
 * @var $block \GreenView\Viewer\Block\Adminhtml\System\Config\ConnectionStatus
 */
$companyInfo = $block->getCompanyInfo();
$hasToken = $block->hasToken();
$isEnabled = $block->isModuleEnabled();
?>

<div id="greenview_connection_status" style="padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
    <?php if (!$isEnabled): ?>
        <div style="padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; margin-bottom: 10px;">
            <strong style="color: #856404;">⚠ Module Disabled</strong>
            <p style="margin: 5px 0 0 0; color: #856404;">Enable the module in "General Settings" above to use GreenView 3D Viewer.</p>
        </div>
    <?php elseif (!$hasToken): ?>
        <div style="padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; margin-bottom: 10px;">
            <strong style="color: #856404;">⚠ No Token Configured</strong>
            <p style="margin: 5px 0 0 0; color: #856404;">Please enter your Company API Token above and click "Validate Token".</p>
        </div>
    <?php elseif ($companyInfo): ?>
        <div style="padding: 10px; background: #d4edda; border-left: 4px solid #28a745; margin-bottom: 15px;">
            <strong style="color: #155724;">✓ Connected to GreenView API</strong>
            <p style="margin: 5px 0 0 0; color: #155724; font-size: 12px;">
                API Endpoint: <?= $block->escapeHtml($block->getApiUrl()) ?>
            </p>
        </div>

        <div style="background: white; padding: 15px; border-radius: 4px; border: 1px solid #e0e0e0;">
            <h4 style="margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #28a745; color: #333;">
                Company Information
            </h4>

            <table style="width: 100%; border-collapse: collapse;">
                <?php if (isset($companyInfo['imageUrl']) && $companyInfo['imageUrl']): ?>
                    <tr>
                        <td colspan="2" style="padding: 0 0 15px 0; text-align: center;">
                            <img src="<?= $block->escapeUrl($companyInfo['imageUrl']) ?>"
                                 alt="<?= $block->escapeHtml($companyInfo['name'] ?? 'Company Logo') ?>"
                                 style="max-width: 200px; max-height: 100px; border-radius: 4px; border: 1px solid #ddd;" />
                        </td>
                    </tr>
                <?php endif; ?>

                <tr>
                    <td style="padding: 8px 10px; font-weight: bold; color: #555; width: 30%; background: #f5f5f5;">Company Name:</td>
                    <td style="padding: 8px 10px; color: #333;"><?= $block->escapeHtml($companyInfo['name'] ?? '-') ?></td>
                </tr>

                <?php if (!empty($companyInfo['email'])): ?>
                    <tr>
                        <td style="padding: 8px 10px; font-weight: bold; color: #555; background: #f5f5f5;">Email:</td>
                        <td style="padding: 8px 10px; color: #333;">
                            <a href="mailto:<?= $block->escapeHtml($companyInfo['email']) ?>" style="color: #1979c3; text-decoration: none;">
                                <?= $block->escapeHtml($companyInfo['email']) ?>
                            </a>
                        </td>
                    </tr>
                <?php endif; ?>

                <?php if (!empty($companyInfo['phone'])): ?>
                    <tr>
                        <td style="padding: 8px 10px; font-weight: bold; color: #555; background: #f5f5f5;">Phone:</td>
                        <td style="padding: 8px 10px; color: #333;"><?= $block->escapeHtml($companyInfo['phone']) ?></td>
                    </tr>
                <?php endif; ?>

                <?php if (!empty($companyInfo['address'])): ?>
                    <tr>
                        <td style="padding: 8px 10px; font-weight: bold; color: #555; background: #f5f5f5;">Address:</td>
                        <td style="padding: 8px 10px; color: #333;"><?= $block->escapeHtml($companyInfo['address']) ?></td>
                    </tr>
                <?php endif; ?>

                <?php if (!empty($companyInfo['website'])): ?>
                    <tr>
                        <td style="padding: 8px 10px; font-weight: bold; color: #555; background: #f5f5f5;">Website:</td>
                        <td style="padding: 8px 10px; color: #333;">
                            <a href="<?= $block->escapeUrl('https://' . $companyInfo['website']) ?>" target="_blank" style="color: #1979c3; text-decoration: none;">
                                <?= $block->escapeHtml($companyInfo['website']) ?>
                            </a>
                        </td>
                    </tr>
                <?php endif; ?>

                <?php if (!empty($companyInfo['id'])): ?>
                    <tr>
                        <td style="padding: 8px 10px; font-weight: bold; color: #555; background: #f5f5f5;">Company ID:</td>
                        <td style="padding: 8px 10px; color: #666; font-family: monospace; font-size: 11px;"><?= $block->escapeHtml($companyInfo['id']) ?></td>
                    </tr>
                <?php endif; ?>
            </table>
        </div>
    <?php else: ?>
        <div style="padding: 10px; background: #f8d7da; border-left: 4px solid #dc3545; margin-bottom: 10px;">
            <strong style="color: #721c24;">✗ Unable to Connect</strong>
            <p style="margin: 5px 0 0 0; color: #721c24;">
                Could not retrieve company information. Please check your API token and try validating it again.
            </p>
        </div>
    <?php endif; ?>
</div>
