<?php
/**
 * Last Sync Template
 *
 * @var $block \GreenView\Viewer\Block\Adminhtml\Splats\LastSync
 */
$lastSyncTime = $block->getLastSyncTime();
?>

<div class="admin__data-grid-header" style="padding: 10px 0 5px 0;">
    <div style="padding: 8px 15px; background: #f5f5f5; border-radius: 4px; display: inline-block; font-size: 12px; color: #666; border: 1px solid #e0e0e0;">
        <span style="font-weight: 600; color: #333;">Last Synced:</span>
        <span id="last-sync-text" data-timestamp="<?= $lastSyncTime ?: '0' ?>" style="margin-left: 5px;">
            <?= $block->escapeHtml($block->getFormattedLastSync()) ?>
        </span>
    </div>
</div>

<script type="text/javascript">
require(['jquery'], function($) {
    function updateLastSync() {
        var timestamp = parseInt($('#last-sync-text').data('timestamp'));

        if (!timestamp || timestamp === 0) {
            $('#last-sync-text').text('Never');
            return;
        }

        var now = Math.floor(Date.now() / 1000);
        var diff = now - timestamp;
        var text = '';

        if (diff < 60) {
            text = 'Just now';
        } else if (diff < 3600) {
            var minutes = Math.floor(diff / 60);
            text = minutes + (minutes === 1 ? ' minute ago' : ' minutes ago');
        } else if (diff < 86400) {
            var hours = Math.floor(diff / 3600);
            text = hours + (hours === 1 ? ' hour ago' : ' hours ago');
        } else {
            var days = Math.floor(diff / 86400);
            text = days + (days === 1 ? ' day ago' : ' days ago');
        }

        $('#last-sync-text').text(text);
    }

    // Update every minute
    setInterval(updateLastSync, 60000);
});
</script>
